<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tầm Soát Ung Thư Phổi Bằng CT Liều Thấp (LDCT)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.counter.dev/script.js" data-id="86e74dda-26a8-41de-99d1-63d0e8fec60e" data-utcoffset="7"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ]
        },
        chtml: {
          scale: 0.95
        }
      };
    </script>
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #0056b3; /* Blue */
            --secondary-color: #007BFF; /* Lighter Blue */
            --text-color: #212529; /* Darker text for better contrast */
            --text-light: #495057; /* Lighter text */
            --light-gray: #f8f9fa; /* Slightly lighter gray */
            --white: #fff;
            --border-color: #dee2e6;
            --header-bg: var(--primary-color);
            --header-text: var(--white);
            --link-color: var(--primary-color);
            --link-hover-color: #003d80;
            --table-header-bg: var(--primary-color);
            --table-header-text: var(--white);
            --danger-color: #dc3545; /* Red for emphasis/results */
            --font-primary: 'Lato', 'Arial', sans-serif;
            --font-secondary: 'Roboto', sans-serif;
        }

        /* Base Styles */
        body {
            font-family: var(--font-primary);
            background-color: var(--light-gray);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.75;
            font-size: 18px;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        section {
            max-width: 1000px;
            margin: 35px auto;
            background: var(--white);
            padding: 30px 35px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-secondary);
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1.4;
        }

        h2 {
            text-align: center;
            margin-bottom: 35px;
            font-size: 28px;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 18px;
            font-size: 22px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 8px;
            display: inline-block;
        }

        ul {
            padding-left: 25px;
            margin-bottom: 18px;
        }

        li {
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 1.1em;
        }

        a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--link-hover-color);
            text-decoration: underline;
        }

        strong, b {
           font-weight: 700;
           color: var(--primary-color);
        }

        /* Header */
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 30px 15px;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 30px;
            font-weight: 700;
            color: var(--header-text);
            border-bottom: none;
            line-height: 1.3;
        }

        .subhead {
            font-size: 19px;
            opacity: 0.9;
            margin-top: 10px;
        }

        /* Navigation */
        nav {
            background-color: var(--primary-color);
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        nav div {
            max-width: 1000px;
            margin: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        nav a {
            color: var(--white);
            text-decoration: none;
            font-size: 19px;
            font-weight: 700;
            padding: 5px 0;
            border-bottom: 2px solid transparent;
            transition: border-bottom 0.3s ease;
        }

        nav a:hover {
            border-bottom: 2px solid var(--white);
            text-decoration: none;
            color: var(--white);
        }

        nav span {
            color: rgba(255, 255, 255, 0.5);
            font-size: 20px;
            line-height: 1;
        }

        /* Credits */
        .credits {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .credits img {
           width: 85px;
           height: auto;
           margin-bottom: 0;
        }

        .credits p {
            margin: 0;
            font-weight: 500;
            font-size: 17px;
            color: var(--text-light);
        }

        .credits p span {
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Grid Layout */
        .grid-2col {
            display: flex;
            gap: 35px;
            flex-wrap: wrap;
        }

        /* Organization/Study Box Styles */
        .organization, .study-highlight {
           flex: 1 1 45%;
           min-width: 300px;
           background: var(--white);
           border-left: 5px solid var(--secondary-color);
           padding: 25px 30px;
           border-radius: 8px;
           box-shadow: 0 3px 8px rgba(0, 0, 0, 0.07);
           margin-bottom: 25px;
        }

        .study-highlight {
            border-left-color: var(--primary-color);
        }

        .organization ul, .study-highlight ul {
            margin-bottom: 25px;
        }

        .detail-link a {
            color: var(--danger-color);
            text-decoration: underline;
            font-size: 16px;
            display: inline-block;
            font-weight: 600;
        }
         .detail-link a:hover {
            color: #a71d2a;
         }

        .view-study-link {
           background: var(--primary-color);
           color: white;
           padding: 12px 22px;
           border-radius: 5px;
           text-decoration: none;
           font-weight: 600;
           display: inline-block;
           transition: background-color 0.3s ease;
           text-align: center;
           font-size: 17px;
        }
        .view-study-link.small-link {
           padding: 10px 18px;
           font-size: 16px;
        }
        .view-study-link:hover {
           background-color: var(--link-hover-color);
           color: white;
           text-decoration: none;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-top: 25px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 14px 16px;
            text-align: left;
            vertical-align: middle;
        }

        th {
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            font-weight: 700;
            text-align: center;
            font-size: 17px;
            font-family: var(--font-secondary);
        }

        tbody tr:nth-child(odd) {
           background-color: #f8f9fa;
        }
        tbody tr:hover {
           background-color: #e9ecef;
        }

        td {
            font-weight: 400;
        }
        td.highlight-col {
           font-weight: 600;
        }
        /* Vendor specific colors */
        td.highlight-col.ge { color: #0073e6; }
        td.highlight-col.siemens { color: #009999; }
        td.highlight-col.philips { color: #005eb8; }
        td.highlight-col.toshiba, td.highlight-col.canon { color: #d71920; }


        td img {
           max-width: 110px;
           height: auto;
           display: block;
           margin: auto;
           cursor: pointer;
           border-radius: 4px;
        }
        /* Specific table styling for k-factor and dose comparison tables */
        .k-factor-table th, .k-factor-table td,
        .dose-table th, .dose-table td {
             padding: 10px 12px; /* Adjust padding if needed */
        }


        /* Dose Calculation Section */
        .dose-calculation-explanation ul {
            margin-bottom: 30px;
        }
         .dose-calculation-explanation strong {
            font-weight: 600;
            color: var(--text-color);
         }

        .dose-calculation-example {
           background:#f0f5fb;
           padding: 30px;
           border-radius: 8px;
           border: 1px solid #cde2ff;
           margin-top: 30px;
        }
         .dose-calculation-example p:first-child { margin-top: 0;}
         .dose-calculation-example .comparison-text {
             font-size: 16px;
             color: var(--text-light);
             font-style: italic;
         }


        .formula-box {
           display: inline-block;
           border: 1px solid var(--primary-color);
           padding: 12px 22px;
           color: var(--primary-color);
           font-weight: 700;
           border-radius: 5px;
           background-color: #e7f1ff;
           margin-top: 15px;
           text-align: center;
           font-family: 'Courier New', Courier, monospace;
           font-size: 17px;
        }
         .formula-box .result {
             color: var(--danger-color);
             font-weight: 700;
         }

        .source-ref {
            text-align: center;
            font-style: italic;
            color: var(--text-light);
            margin-top: 20px;
            font-size: 16px;
        }
        .source-ref a {
            text-decoration: underline;
        }
        .source-ref.small-ref {
            font-size: 15px;
            text-align: right;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px 15px;
            color: var(--header-text);
            background: var(--primary-color);
            margin-top: 45px;
        }
         footer p {
            margin: 10px 0;
            font-size: 16px;
            font-weight: 400;
         }
          footer strong {
              font-weight: 700;
              color: inherit;
          }
          footer p:last-child {
            font-size: 15px;
            opacity: 0.85;
          }

        /* Parameters Table Disclaimer */
        .parameters-disclaimer {
            text-align: center;
            font-size: 17px;
            color: var(--text-light);
            margin: 10px 0 25px 0;
        }
         .aec-disclaimer {
            font-size: 15px;
            color: var(--text-light);
            margin-top: 15px;
         }


        /* Responsive */
        @media (max-width: 768px) {
            body {
                font-size: 17px;
            }
            .grid-2col {
                flex-direction: column;
                gap: 25px;
            }
            .organization, .study-highlight {
                flex-basis: 100%;
                min-width: unset;
            }
            header h1 { font-size: 26px; }
            .subhead { font-size: 17px; }
            nav a { font-size: 17px; font-weight: 600;}
            nav div { gap: 20px; }
            section { padding: 25px 20px; }
            h2 { font-size: 24px; margin-bottom: 30px; }
            h3 { font-size: 20px; }
            th, td { padding: 12px 10px; }
            th {font-size: 16px;}
            .credits p { font-size: 16px; }
            footer p {font-size: 15px;}
            footer p:last-child {font-size: 14px;}
            .formula-box { font-size: 16px; padding: 10px 18px;}
        }
        @media (max-width: 480px) {
            body { font-size: 16px; }
            header h1 { font-size: 22px; }
            .subhead { font-size: 15px; }
            nav a { font-size: 15px; }
            nav div { gap: 15px; }
            h2 { font-size: 21px;}
            h3 { font-size: 19px;}
            th { font-size: 15px; }
            td { font-size: 16px; }
            .credits p { font-size: 15px; }
            .view-study-link { font-size: 16px; padding: 10px 18px;}
            .view-study-link.small-link { font-size: 15px; padding: 8px 15px;}
            .formula-box { font-size: 15px; padding: 8px 15px;}
            footer p {font-size: 14px;}
            footer p:last-child {font-size: 13px;}
        }
    </style>
</head>

<body>
    <header>
        <h1>
            TRANG THÔNG TIN HƯỚNG DẪN TẦM SOÁT UNG THƯ PHỔI BẰNG CT LIỀU THẤP<br>
            LUNG CANCER SCREENING BY LOW DOSE CT (LDCT)
        </h1>
        <p class="subhead">TỔNG HỢP KHUYẾN CÁO - GIỚI HẠN LIỀU KHUYẾN NGHỊ - THÔNG SỐ CÀI ĐẶT</p>
    </header>

    <nav>
      <div>
        <a href="#guidelines">KHUYẾN CÁO</a>
        <span>|</span>
        <a href="#studies">NGHIÊN CỨU</a>
        <span>|</span>
        <a href="#dose-limits">GIỚI HẠN LIỀU</a>
        <span>|</span>
        <a href="#parameters">THÔNG SỐ MÁY</a>
        <span>|</span>
        <a href="https://vnrad.tech/dosecal/" target="_blank">CÔNG CỤ TÍNH LIỀU</a>
      </div>
    </nav>

    <div class="credits">
      <img src="https://i.postimg.cc/tTbb7VJW/81dc535f2325f27bab34.jpg" alt="Logo KTV 3 Miền">
      <p>Biên soạn bởi nhóm <span>KTV 3 Miền</span></p>
    </div>

    <section id="guidelines">
        <h2>Khuyến cáo tầm soát từ các tổ chức y tế</h2>
        <div class="grid-2col">
            <div class="organization">
                <h3>Hiệp hội Ung thư Hoa Kỳ (ACS)</h3>
                <ul>
                    <li>Tuổi: 50 - 80</li>
                    <li>Hút thuốc ≥ 20 gói-năm</li>
                    <li>Đang hút hoặc đã bỏ trong vòng 15 năm</li>
                </ul>
                <div class="detail-link">
                    <a href="https://www.cancer.org/cancer/screening/screening-recommendations-by-age.html#50-64" target="_blank">Xem khuyến cáo chi tiết từ ACS</a>
                </div>
            </div>
            <div class="organization">
                <h3>Hiệp hội Phổi Hoa Kỳ (ALA)</h3>
                <ul>
                    <li>Tuổi: 50 - 80</li>
                    <li>Hút thuốc ≥ 20 gói-năm</li>
                    <li>Đang hút hoặc đã bỏ trong vòng 15 năm</li>
                    <li>Không có bệnh lý nghiêm trọng hạn chế điều trị</li>
                </ul>
                <div class="detail-link">
                    <a href="https://www.lung.org/lung-health-diseases/lung-disease-lookup/lung-cancer/saved-by-the-scan" target="_blank">Xem khuyến cáo chi tiết từ ALA</a>
                </div>
            </div>
        </div>
    </section>

    <section id="studies">
        <h2>Các nghiên cứu nổi bật về LDCT</h2>

        <article class="study-highlight">
            <h3>National Lung Screening Trial (NLST) - Hoa Kỳ</h3>
            <p>Nghiên cứu tiên phong (công bố 2011) so sánh LDCT và X-quang ngực trên <strong>53,000+ người</strong> có nguy cơ cao (55–74 tuổi, ≥30 gói-năm).</p>
            <ul>
                <li><strong>Kết quả chính:</strong> LDCT giúp <strong>giảm 20%</strong> tỷ lệ tử vong do ung thư phổi.</li>
                <li>Phát hiện ung thư ở giai đoạn sớm hơn đáng kể so với X-quang.</li>
            </ul>
            <p style="text-align:center;">
                <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1102873" target="_blank" class="view-study-link">Xem chi tiết nghiên cứu (NEJM)</a>
            </p>
        </article>

        <div class="grid-2col">
            <article class="organization">
                <h3>NELSON Trial - Châu Âu</h3>
                <p>Nghiên cứu lớn tại Hà Lan–Bỉ (công bố 2020) trên <strong>15,700+ người</strong> (50–74 tuổi, ≥15–20 gói-năm).</p>
                <ul>
                    <li>So sánh LDCT với nhóm không tầm soát.</li>
                    <li><strong>Kết quả:</strong> Giảm <strong>24%</strong> tử vong do ung thư phổi ở nam, và <strong>33%</strong> ở nữ sau 10 năm.</li>
                </ul>
                <div style="margin-top: 20px; text-align:center;">
                    <a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1911793" target="_blank" class="view-study-link small-link">Xem chi tiết nghiên cứu (NEJM 2020)</a>
                </div>
            </article>

            <article class="organization">
                <h3>LUSI Study - Đức</h3>
                 <p>Nghiên cứu tại Đức (công bố 2018) trên <strong>4,000+ người</strong> có nguy cơ cao (≥25 gói-năm).</p>
                <ul>
                    <li>So sánh LDCT với nhóm không tầm soát.</li>
                    <li><strong>Kết quả:</strong> Hiệu quả giảm tử vong do ung thư phổi rõ rệt hơn ở nữ giới (giảm <strong>26%</strong>).</li>
                </ul>
                 <div style="margin-top: 38px; text-align:center;">
                    <a href="https://pubmed.ncbi.nlm.nih.gov/31162856/" target="_blank" class="view-study-link small-link">Xem chi tiết nghiên cứu (PubMed)</a>
                 </div>
            </article>
        </div>
    </section>

    <section id="dose-limits">
        <h2>Giới hạn liều khuyến nghị trong LDCT</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Tổ chức</th>
                        <th>DLP (mGy·cm)</th>
                        <th>$CTDI_{vol}$ (mGy)</th>
                        <th>Ghi chú</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>American College of Radiology (ACR)</td>
                        <td>≤ 75 (Nam) / ≤ 60 (Nữ)</td>
                        <td>≤ 3.0</td>
                        <td>Áp dụng cho bệnh nhân có chỉ số khối cơ thể (BMI) &lt; 30 kg/m²</td>
                    </tr>
                    <tr>
                        <td>American Association of Physicists in Medicine (AAPM)</td>
                        <td>≤ 100</td>
                        <td>≤ 3.0</td>
                        <td>Hướng dẫn chung về giới hạn liều tham khảo</td>
                    </tr>
                    <tr>
                        <td>European Guidelines (EU-ETS, ESR)</td>
                        <td>≤ 100</td>
                        <td>≤ 3.0</td>
                        <td>Mức liều tối ưu được đề xuất cho các chương trình tầm soát</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2 style="margin-top: 40px;">Giới hạn $CTDI_{vol}$ khuyến nghị theo cân nặng (Tham khảo AAPM)</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Phân loại bệnh nhân</th>
                        <th>Cân nặng (kg)</th>
                        <th>$CTDI_{vol}$ mục tiêu (mGy)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Nhỏ (Small)</td>
                        <td>50 – < 70</td>
                        <td>≤ 2.0</td>
                    </tr>
                    <tr>
                        <td>Trung bình (Medium)</td>
                        <td>70 – < 90</td>
                        <td>≤ 3.0</td>
                    </tr>
                     <tr>
                        <td>Lớn (Large)</td>
                        <td>90 – < 110</td>
                        <td>≤ 5.0</td>
                    </tr>
                     <tr>
                        <td>Rất lớn (Very Large)</td>
                        <td>≥ 110</td>
                        <td>≤ 7.0</td>
                    </tr>
                </tbody>
            </table>
             <p class="source-ref small-ref">*Dựa trên AAPM Task Group 204 & 225 recommendations.</p>
        </div>


        <h2 style="margin-top: 40px;">Giải thích các thông số liều bức xạ CT</h2>
        <div class="dose-calculation-explanation">
            <ul>
                <li><strong>$CTDI_{vol}$ (mGy):</strong> Chỉ số liều CT thể tích (Computed Tomography Dose Index volume). Phản ánh liều bức xạ trung bình hấp thụ tại một lát cắt trong thể tích quét, đã hiệu chỉnh cho pitch. Dùng để so sánh và tối ưu protocol.</li>
                <li><strong>$DLP$ (mGy·cm):</strong> Tích số liều và chiều dài quét (Dose-Length Product). Phản ánh tổng năng lượng bức xạ truyền cho bệnh nhân trong toàn bộ quá trình quét. $DLP = CTDI_{vol} \times \text{Chiều dài quét (cm)}$.</li>
                <li><strong>Liều hiệu dụng (Effective Dose, mSv):</strong> Ước tính nguy cơ sinh học tổng thể do bức xạ gây ra cho toàn bộ cơ thể. Tính bằng cách nhân $DLP$ với hệ số chuyển đổi ($k$) đặc trưng cho vùng cơ thể được quét.</li>
            </ul>
            <div style="text-align:center;">
                 <div class="formula-box" style="padding: 15px 25px;">
                     Liều hiệu dụng (mSv) = $DLP$ (mGy·cm) × $k$ (mSv/mGy·cm)
                 </div>
            </div>
        </div>

         <div class="dose-calculation-example">
            <h3>Ví dụ tính liều hiệu dụng trong LDCT</h3>
            <p><strong>Thông tin ca chụp:</strong></p>
            <ul>
                <li>Vùng khảo sát: Ngực</li>
                <li>Chỉ số $DLP$ hiển thị trên máy: <strong>80 mGy·cm</strong></li>
                <li>Hệ số chuyển đổi $k$ cho vùng ngực (người lớn): <strong>0.014 mSv/mGy·cm</strong></li>
            </ul>
            <p><strong>Áp dụng công thức:</strong></p>
            <div style="text-align:center;">
                <div class="formula-box">
                    Liều hiệu dụng = 80 × 0.014 = <span class="result">1.12 mSv</span>
                </div>
            </div>
            <p style="margin-top:15px;">&rarr; Liều hiệu dụng ước tính cho bệnh nhân trong ca chụp này là <strong>1.12 mSv</strong>.</p>
            <p class="comparison-text">
                (So sánh: Liều phông tự nhiên hàng năm ở Việt Nam khoảng 1-2 mSv. Một chuyến bay dài có thể nhận liều khoảng 0.05-0.1 mSv).
            </p>
         </div>

        <h3 style="margin-top: 30px; text-align:center; display:block; border:none;">Hệ số chuyển đổi ($k$) theo vùng cơ thể (ICRP 103)</h3>
        <div class="table-container" style="max-width: 600px; margin: 20px auto;">
             <table>
                <thead>
                    <tr>
                        <th>Vùng cơ thể</th>
                        <th>Hệ số $k$ (mSv / mGy·cm)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Đầu</td><td>0.0021</td></tr>
                    <tr><td>Cổ</td><td>0.0059</td></tr>
                    <tr><td>Ngực</td><td>0.014</td></tr>
                    <tr><td>Bụng</td><td>0.015</td></tr>
                    <tr><td>Chậu</td><td>0.019</td></tr>
                    <tr><td>Thân (Ngực-Bụng-Chậu)</td><td>0.015</td></tr>
                </tbody>
             </table>
        </div>
        <p class="source-ref">Nguồn tham khảo hệ số k: <a href="https://www.icrp.org/publication.asp?id=ICRP%20Publication%20103" target="_blank">ICRP Publication 103</a></p>
    </section>

    <section id="parameters">
        <h2>Thông số cài đặt LDCT tham khảo theo máy</h2>
        <p class="parameters-disclaimer">Thông số dưới đây chỉ mang tính tham khảo, cần được tối ưu tại từng cơ sở dựa trên thiết bị và quần thể bệnh nhân cụ thể. Nhấn vào ảnh để xem chi tiết (nếu có).</p>
        <div class="table-container">
           <table>
              <thead>
                  <tr>
                      <th>Hãng máy</th>
                      <th>Tên AEC*</th>
                      <th>Dòng máy/Tên Protocol</th>
                      <th>Thông số (Click ảnh xem link)</th>
                  </tr>
              </thead>
              <tbody id="table-body">
                  <tr><td colspan="4" style="text-align:center; padding: 30px;">Đang tải dữ liệu thông số máy...</td></tr>
              </tbody>
           </table>
        </div>
         <p class="aec-disclaimer">*AEC: Automatic Exposure Control (Kiểm soát phơi nhiễm tự động)</p>
    </section>

    <footer>
        <p>© <span id="current-year"></span> <strong>Cộng đồng kỹ thuật viên hình ảnh y học Việt Nam</strong> – Trang thông tin Tầm soát Ung thư phổi bằng CT liều thấp</p>
        <p>Biên soạn bởi nhóm <strong>KTV 3 Miền</strong> | Dành cho mục đích đào tạo & tham khảo y khoa</p>
        <p>Mọi thông tin trên trang chỉ mang tính chất tham khảo, không thay thế cho chẩn đoán và chỉ định của bác sĩ chuyên khoa.</p>
    </footer>

    <script>
        // Set current year in footer
        document.getElementById("current-year").textContent = new Date().getFullYear();

        // Fetch machine parameters data
        const apiUrl = "https://script.google.com/macros/s/AKfycbxdrVHpZUf8xlKkltSWV4AX45clpx-cH3IkpUnhJbvhEmVSF8vA5MamM4y7ls7Nofur/exec";

        fetch(apiUrl)
           .then(response => {
               if (!response.ok) {
                   throw new Error(`Không thể kết nối API. Status: ${response.status}`);
               }
               return response.json();
           })
           .then(data => {
               const tableBody = document.getElementById("table-body");
               tableBody.innerHTML = ''; // Clear loading message

               if (!data || !Array.isArray(data) || data.length === 0) {
                   console.error("Dữ liệu API không hợp lệ hoặc rỗng:", data);
                   tableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Không có dữ liệu thiết bị hoặc định dạng dữ liệu không đúng.</td></tr>';
                   return;
               }

               data.forEach(row => {
                   if (typeof row !== 'object' || row === null) {
                       console.warn("Bỏ qua hàng dữ liệu không hợp lệ:", row);
                       return;
                   }

                   const tr = document.createElement("tr");
                   // Thay đổi: Gán '' thay vì 'N/A' khi dữ liệu thiếu
                   let hangMay = row.HANGMAY || '';
                   let tenMay = row.TENMAY || '';
                   let aec = row.AEC || '';
                   let link = row.LINK;
                   let hangMayClass = typeof hangMay === 'string' ? hangMay.toLowerCase().replace(/[\s_]+/g, '-') : 'unknown-vendor';
                   let isValidImageUrl = link && typeof link === 'string' && (link.startsWith('http://') || link.startsWith('https://') || link.startsWith('data:image'));
                   let parameterCellContent = 'Không có ảnh';

                   if (isValidImageUrl) {
                        parameterCellContent = `<a href="${link}" target="_blank" title="Xem chi tiết thông số ${tenMay}">
                                                <img src="${link}" alt="Thông số tham khảo cho ${tenMay} (${hangMay})" >
                                               </a>`;
                   } else if (link) {
                         parameterCellContent = `<span>Link không hợp lệ</span>`;
                   }

                   tr.innerHTML = `
                       <td class="highlight-col ${hangMayClass}">${hangMay}</td>
                       <td>${aec}</td>
                       <td>${tenMay}</td>
                       <td style="text-align: center;">${parameterCellContent}</td>
                   `;
                   tableBody.appendChild(tr);
               });
           })
           .catch(error => {
               console.error("Lỗi khi tải dữ liệu từ API:", error);
               const tableBody = document.getElementById("table-body");
               tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center; color: var(--danger-color); padding: 20px;">
                                        Lỗi: Không thể tải dữ liệu thông số thiết bị.<br> (${error.message})
                                       </td></tr>`;
           });
    </script>

</body>
</html>
