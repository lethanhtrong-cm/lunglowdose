<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Công cụ tính và Thông tin về Liều bức xạ CT</title>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ]
      },
      chtml: {
        scale: 0.95
      }
    };
  </script>

  <script src="https://cdn.counter.dev/script.js" data-id="86e74dda-26a8-41de-99d1-63d0e8fec60e" data-utcoffset="7"></script>

  <style>
    /* Reset and Base Styles */
    html {
        scroll-padding-top: 20px;
        scroll-behavior: smooth;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      line-height: 1.7;
      color: #333;
    }
    h1, h2, h3, h4 { color: #0056b3; margin-top: 1.5em; margin-bottom: 0.8em; }
    a { color: #007BFF; text-decoration: none; }
    a:hover { text-decoration: underline; }
    hr { border: none; border-top: 1px solid #ccc; margin: 2em 0; }
    em { font-style: italic; }

    /* Centered Page Layout */
    .page-container { display: flex; max-width: 1200px; margin: 0 auto; align-items: flex-start; gap: 20px; padding: 0 10px; box-sizing: border-box; }

    /* Side Navigation Bar Styles */
    .side-nav { flex: 0 0 220px; position: sticky; top: 20px; height: calc(100vh - 40px); background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; box-sizing: border-box; overflow-y: auto; z-index: 100; }
    .side-nav h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.1em; color: #343a40; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    .side-nav ul { list-style: none; padding: 0; margin: 0; }
    .side-nav li { margin-bottom: 5px; }
    .side-nav a { display: block; padding: 8px 10px; color: #0056b3; text-decoration: none; border-radius: 4px; transition: background-color 0.2s ease, color 0.2s ease; font-size: 0.95em; }
    .side-nav a:hover, .side-nav a.active { background-color: #007bff; color: white; text-decoration: none; }

    /* Main Content Area Styles */
    .main-content-area { flex: 1; min-width: 0; }

    /* Header Styles */
    .main-header { background-color: #007BFF; color: white; padding: 25px 20px; text-align: center; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-radius: 8px; }
    .main-header h1 { margin: 0 0 10px 0; font-size: 2em; color: white; }
    .main-header p { font-size: 1.1em; margin: 0; opacity: 0.9; }

    /* Main Content Area */
    main { padding: 0; }

    /* Section Styles */
    .content-section { background: #fff; padding: 25px 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 30px; border: 1px solid #e0e0e0; }
    .content-section h2, .content-section h3 { margin-top: 0; }

    /* Calculator Section Specifics */
    .calculator-section .form-group { display: flex; flex-wrap: wrap; gap: 15px 20px; align-items: baseline; margin-bottom: 20px; }
    .calculator-section .form-item { flex: 1 1 150px; min-width: 140px; margin-bottom: 5px; }
    .calculator-section label { font-weight: 600; display: block; margin-bottom: 6px; font-size: 0.9em; color: #555; }
    .calculator-section input, .calculator-section select { width: 100%; padding: 8px 10px; font-size: 0.95em; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; transition: border-color 0.2s ease; }
    .calculator-section input:focus, .calculator-section select:focus { border-color: #007BFF; outline: none; box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
    .calculator-section input[readonly] { background-color: #e9ecef; cursor: not-allowed; }
    .calculator-section .button-container { text-align: center; flex-basis: 100%; margin-top: 15px; }
    .calculator-section button#calculateButton { padding: 10px 25px; background: #007BFF; color: white; border: none; font-size: 1em; border-radius: 6px; cursor: pointer; transition: background-color 0.2s ease; }
    .calculator-section button#calculateButton:hover { background: #0056b3; }

    /* Patient Info Group Styles */
    .patient-info-group { border-top: 1px dashed #ccc; margin-top: 20px; padding-top: 20px; margin-bottom: 5px; }
    .patient-info-group h4 { margin-top: 0; margin-bottom: 15px; font-size: 1em; color: #6c757d; }

    /* Result Display Styles */
    .result-display { margin-top: 20px; padding: 15px; text-align: center; font-size: 1.2em; font-weight: bold; border-radius: 6px; }
    #resultDose.success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; }
    #resultDose.error { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; }

    /* Risk Warning Display Styles (on screen) */
    .risk-warning-display { margin-top: 15px; padding: 15px 20px; font-size: 0.95em; border-radius: 6px; background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; text-align: left; line-height: 1.6; display: none; }
    .risk-warning-display p { margin-top: 0; margin-bottom: 0.8em; }
    .risk-warning-display ul { padding-left: 20px; margin-top: 0.5em; margin-bottom: 0; }
    .risk-warning-display li { margin-bottom: 0.4em; }

    /* Print Button Styles */
     .print-button-container { text-align: center; margin-top: 25px; }
     #printButton { padding: 10px 20px; background-color: #17a2b8; color: white; border: none; font-size: 1em; border-radius: 6px; cursor: pointer; transition: background-color 0.2s ease; display: none; }
     #printButton:hover { background-color: #138496; }

    /* Table Styles */
    table { width: 100%; border-collapse: collapse; margin-top: 20px; border: 1px solid #ccc; }
    th, td { padding: 12px 15px; text-align: left; border: 1px solid #ddd; }
    th { background-color: #e9ecef; color: #495057; font-weight: 600; border-bottom: 2px solid #007BFF; }
    tbody tr:nth-child(even) { background-color: #f8f9fa; }
    tbody tr:hover { background-color: #e2e6ea; }
    .k-factor-table th, .k-factor-table td, .dose-table th, .dose-table td { padding: 10px 12px; }

    /* Source Citation Style */
    .source { font-size: 0.9em; color: #666; margin-top: 20px; text-align: right; }
    .source strong { font-weight: 600; }
    .source a { color: #0056b3; }

    /* Home Button Style */
    .home-button { display: block; width: fit-content; padding: 10px 20px; background-color: #007BFF; color: white; border: none; border-radius: 6px; text-align: center; font-size: 1em; margin: 30px auto 10px auto; cursor: pointer; text-decoration: none; transition: background-color 0.2s ease; }
    .home-button:hover { background-color: #0056b3; color: white; text-decoration: none; }

    /* Dose Report Illustration Styles */
    .dose-report-text-container { border: 1px solid #007BFF; border-radius: 8px; padding: 20px; background-color: #f8f9fa; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; margin-bottom: 15px; }
    .dose-report-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; border-bottom: 1px dashed #007BFF; padding-bottom: 15px; margin-bottom: 15px; }
    .report-title-meta { flex-basis: 60%; min-width: 250px; }
    .report-title-meta h3 { margin: 0 0 10px 0; color: #007BFF; font-size: 1.4em; }
    .meta-data span { display: inline-block; margin-right: 20px; margin-bottom: 5px; font-weight: bold; color: #333; }
    .general-info p { margin: 5px 0 0 0; font-size: 0.9em; color: #555; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.5; text-align: left; }
    .phantom-info { flex-basis: 35%; min-width: 200px; border: 1px solid #ccc; padding: 10px 15px; border-radius: 5px; background-color: #fff; text-align: center; }
    .phantom-info h4 { margin: 0 0 8px 0; font-size: 1.1em; color: #0056b3; }
    .phantom-info p { margin: 4px 0; font-size: 0.9em; text-align: center; }
    .phantom-info hr { margin: 8px 0; border-top: 1px solid #eee; }

    /* --- BEGIN: Responsive Table Wrapper --- */
    .table-responsive-wrapper {
        overflow-x: auto; /* Enable horizontal scroll */
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        margin-bottom: 1em; /* Add some space below the table */
    }
    /* --- END: Responsive Table Wrapper --- */

    .report-table {
        width: 100%;
        min-width: 600px; /* Set a minimum width to prevent extreme squeezing */
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 0.95em;
    }
    .report-table th, .report-table td { border: 1px solid #ccc; padding: 6px 8px; text-align: center; vertical-align: middle; white-space: nowrap; /* Prevent text wrapping in cells initially */ }
    .report-table th { background-color: #e9ecef; color: #495057; font-weight: bold; }
    .report-table td:first-child { text-align: left; white-space: normal; /* Allow first column to wrap */ word-break: break-word; }
    .report-note { font-size: 0.85em; font-style: italic; color: #555; margin-top: 10px; text-align: right; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .caption-text { font-size: 0.95em; color: #333; line-height: 1.6; text-align: justify; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

    /* Warning Section Styles */
    .warning-section { background-color: #fef9e7; border-left: 5px solid #f1c40f; padding: 20px 25px; }
    .warning-section h2, .warning-section h3 { color: #b7950b; }
    .warning-section hr { border-top: 1px solid #f1c40f; }
    .warning-section ul { padding-left: 20px; list-style-position: outside; }
    .warning-section ul ul { margin-top: 5px; }
    .warning-section .emphasis-message { font-weight: bold; text-align: center; margin-top: 1.5em; color: #b7950b; }
    .warning-section .source-link { text-align: center; margin-top: 1em; font-size: 0.95em; }

    /* Explanation Section Styles */
    .formula-display { font-size: 1.1em; background-color: #e7f3ff; padding: 15px; border-radius: 6px; border: 1px solid #007BFF; color: #0056b3; text-align: center; margin: 1.5em 0; overflow-x: auto; }
    .explanation-section h3, .explanation-section h4 { margin-bottom: 0.5em; }
    .explanation-section p, .explanation-section ul { margin-bottom: 1em; }
    .explanation-section ul { padding-left: 25px; list-style-position: outside; }

    /* Justify Text for specific paragraphs */
    .calculator-section > p, .warning-section > p, .explanation-section p, .dose-comparison-section > p, .caption-text { text-align: justify; }
    /* Optional Justify Lists */
    /* .warning-section ul li, .explanation-section ul li { text-align: justify; } */

    /* Footer Styles */
    .main-footer { background-color: #007BFF; color: #ffffff; padding: 30px 20px; margin-top: 40px; text-align: center; font-size: 0.9em; border-radius: 8px; }
    .main-footer p { margin: 8px 0; line-height: 1.6; opacity: 0.95; text-align: center; }
    .main-footer strong { color: #ffffff; }
    .main-footer em { font-style: italic; opacity: 0.85; display: block; margin-top: 15px; }
    .main-footer a { color: #cce5ff; /* Lighter blue for footer links */ }
    .main-footer a:hover { color: #ffffff; text-decoration: underline; }

    /* Responsive Styles */
    @media (max-width: 992px) { /* Medium screens */
        .page-container { max-width: 95%; gap: 15px; }
        .side-nav { flex-basis: 180px; }
    }
    @media (max-width: 768px) { /* Small screens */
        .page-container { display: block; max-width: 95%; padding: 0 5px; }
        .side-nav { position: static; height: auto; width: 100%; margin-bottom: 20px; display: none; }
        .main-content-area { margin-left: 0; }
        .main-header, .main-footer { border-radius: 0; }
        .content-section { padding: 15px 20px; }
         .calculator-section .form-item { flex-basis: calc(50% - 10px); }

         /* Adjust report table font/padding on smaller screens */
         .report-table th, .report-table td {
             padding: 4px 6px; /* Reduce padding */
             font-size: 0.85em; /* Reduce font size */
         }
         .report-table {
             min-width: 0; /* Allow table to shrink below 600px if needed */
         }
    }

    /* --- BEGIN: Print Styles --- */
    /* Hide the print container by default on screen */
    #print-output-container { display: none; }

    @media print {
        /* Hide everything that is a direct child of body EXCEPT the print container */
        body > *:not(#print-output-container) {
            display: none !important;
            visibility: hidden !important;
        }
        /* Reset body and show print container */
        body {
            background: #fff !important;
            margin: 0 !important;
            padding: 0 !important;
            color: #000 !important;
            font-size: 10pt;
            line-height: 1.4;
            font-family: 'Times New Roman', Times, serif;
        }
        #print-output-container {
            display: block !important;
            visibility: visible !important;
            width: auto !important;
            max-width: 180mm !important;
            margin: 20mm auto !important; /* Center content on page */
            padding: 0 !important;
            border: none !important;
            box-shadow: none !important;
        }

        /* Styling for elements within the print container */
        #print-title { text-align: center; font-size: 14pt; font-weight: bold; margin-bottom: 20px; border-bottom: 1px solid #000; padding-bottom: 10px; }
        #print-patient-info, #print-input-params { margin-bottom: 15px; border: 1px solid #ccc; padding: 10px 15px; border-radius: 4px; }
        #print-patient-info h4, #print-input-params h4 { margin-top: 0; margin-bottom: 10px; font-size: 11pt; border-bottom: 1px dotted #ccc; padding-bottom: 5px; font-weight: bold; }
        #print-patient-info div, #print-input-params div { margin-bottom: 5px; font-size: 10pt; }
        #print-patient-info span, #print-input-params span { display: inline-block; min-width: 110px; font-weight: bold; padding-right: 8px; }

        /* Style for the formula section */
        #print-formula {
            margin: 20px 0 10px 0 !important;
            padding: 8px 15px !important;
            border: 1px dashed #007BFF !important; /* Blue dashed border */
            background-color: transparent !important;
            color: #0056b3 !important; /* Blue text */
            font-size: 10pt !important;
            text-align: center;
            font-style: italic;
            border-radius: 4px !important;
            box-shadow: none !important;
            width: auto !important;
            display: block !important;
            visibility: visible !important;
            page-break-inside: avoid;
        }

        #print-result-dose, #print-risk-warning {
            margin: 10px 0 20px 0 !important;
            padding: 12px 15px !important;
            border: 1px solid #007BFF !important; /* Blue border */
            background-color: transparent !important; /* Remove background */
            color: #0056b3 !important; /* Blue text */
            font-size: 10pt !important;
            border-radius: 4px !important;
            box-shadow: none !important;
            width: auto !important;
            display: block !important;
            visibility: visible !important;
            page-break-inside: avoid;
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        #print-result-dose {
            font-weight: bold;
            text-align: center;
            font-size: 11pt !important;
            /* background-color: #f0f0f0 !important; */ /* Removed background */
            margin-top: 10px !important;
        }
        #print-risk-warning {
            text-align: left;
            /* background-color: #fafafa !important; */ /* Removed background */
        }
        #print-risk-warning p, #print-risk-warning li { margin-bottom: 0.6em; }
        #print-risk-warning p:first-child { font-weight: bold; font-size: 10.5pt; }
        #print-risk-warning ul { padding-left: 18px; margin-top: 0.4em; list-style-type: disc; list-style-position: outside; }
        #print-risk-warning strong { font-weight: bold; color: #0056b3 !important; /* Ensure bold text is also blue */ }
        #print-date-footer { text-align: right; font-size: 9pt; margin-top: 25px; border-top: 1px solid #ccc; padding-top: 8px; font-style: italic; }

        /* Hide elements marked specifically not for print */
        .no-print { display: none !important; }
        /* Prevent URLs from being printed after links */
        a[href]:after { content: "" !important; }

    }
    /* --- END: Print Styles --- */

  </style>

</head>
<body>

  <div class="page-container">

      <nav class="side-nav no-print">
          <h3>Điều hướng nhanh</h3>
          <ul>
              <li><a href="#calculator">Máy tính Liều</a></li>
              <li><a href="#dose-report">Minh họa Dose Report</a></li>
              <li><a href="#jama-warning">Cảnh báo JAMA</a></li>
              <li><a href="#dlp-explanation">Giải thích DLP</a></li>
              <li><a href="#effective-dose-explanation">Giải thích Liều hiệu dụng</a></li>
              <li><a href="#cancer-risk-explanation">Ước tính Nguy cơ</a></li>
              <li><a href="#dose-comparison">So sánh Liều</a></li>
          </ul>
      </nav>

      <div class="main-content-area">

          <header class="main-header no-print">
            <h1>Thông tin và Công cụ Tính toán Liều bức xạ <span lang="en">CT</span></h1>
            <p>Hướng dẫn, công cụ tính liều hiệu dụng từ $DLP$, và thông tin tham khảo về liều bức xạ trong X-quang và <span lang="en">CT</span>.</p>
          </header>

          <main>
            <section id="calculator" class="content-section calculator-section">
              <h2 class="no-print">Công cụ tính Liều hiệu dụng từ $DLP$</h2>
              <p class="no-print">Ước tính Liều hiệu dụng ($E$, <span lang="en">Effective Dose</span>) dựa trên chỉ số $DLP$ (<span lang="en">Dose-Length Product</span>) và vùng cơ thể quét <span lang="en">CT</span>.</p>

              <div class="patient-info-group no-print">
                  <h4>Thông tin bệnh nhân (Tùy chọn)</h4>
                  <div class="form-group">
                      <div class="form-item">
                          <label for="patientName">Tên Bệnh nhân:</label>
                          <input id="patientName" type="text" placeholder="Nguyễn Văn A">
                      </div>
                      <div class="form-item">
                          <label for="patientAge">Tuổi:</label>
                          <input id="patientAge" type="number" placeholder="30" min="0">
                      </div>
                      <div class="form-item">
                          <label for="patientId">ID Bệnh nhân:</label>
                          <input id="patientId" type="text" placeholder="1234567">
                      </div>
                  </div>
              </div>

              <div class="form-group no-print">
                <div class="form-item">
                  <label for="bodyRegion">Vùng cơ thể:</label>
                  <select id="bodyRegion">
                    <option value="">-- Chọn vùng --</option>
                    <option value="0.0021">Đầu</option>
                    <option value="0.0059">Cổ</option>
                    <option value="0.014">Ngực</option>
                    <option value="0.015">Bụng</option>
                    <option value="0.019">Khung chậu</option>
                  </select>
                </div>
                <div class="form-item">
                  <label for="kValue">Hệ số $k$ ($mSv \cdot mGy^{-1} \cdot cm^{-1}$):</label>
                  <input id="kValue" type="text" readonly placeholder="Tự động">
                </div>
                <div class="form-item">
                  <label for="dlp">Nhập $DLP$ ($mGy \cdot cm$):</label>
                  <input id="dlp" type="number" placeholder="Ví dụ: 80" min="0.1" step="any">
                </div>
              </div>
              <div class="button-container no-print">
                  <button id="calculateButton">Tính liều</button>
              </div>

              <div id="resultDose" class="result-display no-print"></div>
              <div id="riskWarning" class="risk-warning-display no-print"></div>

              <div class="print-button-container no-print">
                  <button id="printButton"><span role="img" aria-label="Print icon">🖨️</span> In Báo cáo Liều</button>
              </div>

              <h3 class="no-print">Bảng hệ số $k$ (Tham khảo <span lang="en">ICRP 103</span>)</h3>
              <table class="k-factor-table no-print">
                <thead> <tr> <th>Bộ phận</th> <th>Hệ số $k$ ($mSv \cdot mGy^{-1} \cdot cm^{-1}$)</th> </tr> </thead>
                <tbody>
                    <tr><td>Đầu</td><td>0.0021</td></tr>
                    <tr><td>Cổ</td><td>0.0059</td></tr>
                    <tr><td>Ngực</td><td>0.014</td></tr>
                    <tr><td>Bụng</td><td>0.015</td></tr>
                    <tr><td>Khung chậu</td><td>0.019</td></tr>
                </tbody>
              </table>
              <div class="source no-print">
                <p><strong>Nguồn hệ số k:</strong> <a href="https://www.icrp.org/publication.asp?id=ICRP%20Publication%20103" target="_blank" rel="noopener noreferrer" lang="en">ICRP Publication 103, 2007</a></p>
              </div>
              <a href="https://vnrad.tech/lunglowdose/" class="home-button no-print">Trở về trang chủ</a>
            </section>

            <section id="dose-report" class="content-section illustration-section no-print">
                <h2>Minh họa Báo cáo Liều (<span lang="en">Dose Report</span>) - Dạng Văn bản</h2>
                <div class="table-responsive-wrapper">
                    <div class="dose-report-text-container">
                      <div class="dose-report-header">
                          <div class="report-title-meta">
                              <h3>DOSE REPORT</h3>
                              <div class="meta-data">
                                  <span><strong>Tổng mAs:</strong> 2326</span>
                                  <span><strong>Tổng DLP:</strong> 738 mGy·cm</span>
                              </div>
                              <div class="general-info">
                                  <p>- Báo cáo liều được tạo sau khi kết thúc quá trình quét.</p>
                                  <p>- Cung cấp thông tin về kV, mAs, $CTDI_{vol}$, $DLP$.</p>
                              </div>
                          </div>
                          <div class="phantom-info">
                              <h4>LIỀU HẤP THỤ</h4>
                              <p>Ước tính Liều hiệu dụng ($E$) dựa trên:</p>
                              <p>$E \approx \text{Tổng } DLP \times k$</p>
                              <hr>
                              <p><strong>Tham chiếu Phantom:</strong></p>
                              <p>S: $\emptyset$ 16 cm (Đầu/Nhỏ)</p>
                              <p>L: $\emptyset$ 32 cm (Thân/Lớn)</p>
                          </div>
                      </div>
                      <table class="report-table">
                          <thead> <tr> <th>Scan</th> <th>kV</th> <th>mAs / ref.</th> <th>$CTDI_{vol}$* (mGy)</th> <th>$DLP$ (mGy·cm)</th> <th>TI</th> <th>cSL (mm)</th> </tr> </thead>
                          <tbody>
                              <tr> <td>1. Topogram</td> <td>120</td> <td>35</td> <td>0.29 (S)</td> <td>6.7</td> <td>2.4</td> <td>0.6</td> </tr>
                              <tr> <td>2. Head</td> <td>100</td> <td>405 / 542</td> <td>39.25 (S)</td> <td>731.2</td> <td>1.0</td> <td>0.6</td> </tr>
                          </tbody>
                      </table>
                      <p class="report-note">*Giá trị $CTDI_{vol}$ được tham chiếu theo phantom S ( $\emptyset$ 16 cm).</p>
                    </div>
                </div>
                <p class="caption-text"> Minh họa cấu trúc một bảng <span lang="en">Dose Report</span> điển hình hiển thị sau khi kết thúc quét <span lang="en">CT</span>. Các thông số quan trọng cần lưu ý bao gồm $CTDI_{vol}$ (và loại phantom tham chiếu), $DLP$, <span lang="en">mAs</span>, $kVp$. Thông tin này là cơ sở để theo dõi liều và tính toán liều hiệu dụng ước tính cho bệnh nhân. </p>
             </section>

            <article id="jama-warning" class="content-section warning-section no-print">
              <h2><span lang="en">CT</span> và Nguy cơ Ung thư: Thông tin từ nghiên cứu <span lang="en">JAMA</span></h2>
              <p>Một nghiên cứu được công bố trên tạp chí <em lang="en">JAMA Internal Medicine</em> (Lưu ý: Thông tin ngày tháng 4/2025 cần kiểm chứng) đã đưa ra những ước tính về nguy cơ ung thư dài hạn liên quan đến việc sử dụng <span lang="en">CT</span> tại Hoa Kỳ:</p>
              <ul> <li>Nghiên cứu ước tính khoảng <strong>103.000 ca ung thư trong tương lai</strong> có thể liên quan đến 93 triệu lượt chụp <span lang="en">CT</span> được thực hiện trong năm 2023 tại Hoa Kỳ (chiếm khoảng 5% tổng số ca ung thư mới hàng năm tại quốc gia này theo ước tính đó).</li> <li>Nguy cơ này được ghi nhận có thể tăng cao hơn ở các nhóm đối tượng sau: <ul> <li><strong>Trẻ em:</strong> Do các mô đang phát triển nhạy cảm hơn với bức xạ.</li> <li><strong>Bệnh nhân chụp <span lang="en">CT</span> lặp lại nhiều lần:</strong> Do sự tích lũy liều bức xạ theo thời gian.</li> <li><strong>Các khảo sát <span lang="en">CT</span> có liều chiếu cao:</strong> Ví dụ như <span lang="en">CT</span> bụng-chậu, ngực, cột sống, đặc biệt khi thực hiện nhiều pha quét (đa pha).</li> </ul> </li> </ul> <hr> <h3>Khuyến nghị Quan trọng cho Kỹ thuật viên Hình ảnh Y học</h3> <ul> <li><strong>Chỉ định hợp lý:</strong> <span lang="en">CT</span> chỉ nên được thực hiện khi có chỉ định lâm sàng rõ ràng và lợi ích chẩn đoán vượt trội nguy cơ tiềm ẩn. <span lang="en">CT</span> không phải là công cụ tầm soát ung thư đại trà cho mọi đối tượng.</li> <li><strong>Nguyên tắc ALARA:</strong> Luôn tuân thủ nghiêm ngặt nguyên tắc ALARA (<span lang="en">As Low As Reasonably Achievable</span>) – giữ liều bức xạ ở mức thấp nhất có thể mà vẫn đảm bảo chất lượng hình ảnh đủ cho chẩn đoán.</li> <li><strong>Tối ưu hóa <span lang="en">Protocol</span>:</strong> Chủ động tối ưu hóa các thông số kỹ thuật như $kVp$, <span lang="en">mAs</span> (hoặc sử dụng điều biến liều tự động - <span lang="en">AEC/mAs modulation</span>), <span lang="en">pitch</span>, và giới hạn chiều dài vùng quét (<span lang="en">scan length</span>) phù hợp với yêu cầu lâm sàng và đặc điểm bệnh nhân.</li> <li><strong>Hạn chế chụp đa pha:</strong> Chỉ thực hiện các pha quét bổ sung (ví dụ: pha động mạch, tĩnh mạch, muộn) khi thực sự cần thiết và mang lại thông tin chẩn đoán giá trị thêm.</li> <li><strong>Cân nhắc đối tượng nhạy cảm:</strong> Đặc biệt thận trọng và cân nhắc kỹ lưỡng lợi ích/nguy cơ khi chỉ định <span lang="en">CT</span> cho trẻ em, phụ nữ trong độ tuổi sinh sản, và người trẻ tuổi.</li> </ul> <hr> <p class="emphasis-message">Việc áp dụng kỹ thuật chụp <span lang="en">CT</span> tối ưu và đúng chỉ định là trách nhiệm nghề nghiệp, không chỉ đảm bảo chất lượng hình ảnh mà còn góp phần quan trọng vào việc bảo vệ bệnh nhân khỏi rủi ro bức xạ không cần thiết.</p> <p class="source-link"><a href="https://jamanetwork.com/journals/jamainternalmedicine/fullarticle/10.1001/jamainternmed.2025.0505" target="_blank" rel="noopener noreferrer">Tham khảo nghiên cứu gốc tại <span lang="en">JAMA</span></a> (Lưu ý: Link và thông tin bài báo có thể cần cập nhật)</p>
            </article>

            <article id="dlp-explanation" class="content-section explanation-section no-print">
              <h2>Giải thích về $DLP$ (<span lang="en">Dose-Length Product</span>)</h2>
               <p>$DLP$ là một chỉ số quan trọng trong chẩn đoán <span lang="en">CT</span>, đại diện cho tổng lượng phơi nhiễm bức xạ dọc theo chiều dài của vùng được quét. Nó được tính bằng tích của chỉ số liều <span lang="en">CT</span> thể tích ($CTDI_{vol}$) và chiều dài vùng quét (<span lang="en">Scan Length</span>). Đơn vị của $DLP$ thường là $mGy \cdot cm$.</p> <h3>Công thức tính $DLP$:</h3> <div class="formula-display">$$DLP \; (mGy \cdot cm) = CTDI_{vol} \; (mGy) \times \text{Chiều dài quét} \; (cm)$$</div> <p>Trong đó:</p> <ul> <li>$CTDI_{vol}$ (<span lang="en">Computed Tomography Dose Index Volume</span>): Ước tính liều hấp thụ trung bình trong thể tích được chiếu xạ của một lát cắt đại diện, đã hiệu chỉnh cho <span lang="en">pitch</span>. Đơn vị là <span lang="en">miliGray</span> ($mGy$).</li> <li>Chiều dài quét (<span lang="en">Scan Length</span>): Là tổng chiều dài của vùng cơ thể được bao phủ bởi chùm tia <span lang="en">X</span> trong quá trình quét, đơn vị <span lang="en">centimet</span> ($cm$).</li> </ul> <h3>Ý nghĩa và Ứng dụng:</h3> <p>$DLP$ phản ánh tổng năng lượng bức xạ được truyền cho bệnh nhân trong toàn bộ cuộc quét. Nó là một chỉ số hữu ích để:</p> <ul> <li>So sánh mức liều giữa các cuộc quét khác nhau trên cùng một bệnh nhân hoặc giữa các bệnh nhân.</li> <li>Theo dõi và quản lý liều bức xạ tại cơ sở y tế.</li> <li>Là đầu vào quan trọng để ước tính Liều hiệu dụng ($E$), giúp đánh giá nguy cơ sinh học tổng thể.</li> </ul> <h4>Ví dụ tính $DLP$:</h4> <p>Nếu một cuộc quét <span lang="en">CT</span> bụng có $CTDI_{vol} = 10 \, mGy$ và chiều dài quét là $35 \, cm$, thì:</p> <div class="formula-display">$$DLP = 10 \, mGy \times 35 \, cm = 350 \, mGy \cdot cm$$</div>
            </article>

            <article id="effective-dose-explanation" class="content-section explanation-section no-print">
                <h2>Giải thích về Liều hiệu dụng ($E$)</h2>
                <p>Liều hiệu dụng (<span lang="en">Effective Dose</span>, ký hiệu $E$) là một đại lượng được định nghĩa bởi Ủy ban Quốc tế về An toàn Bức xạ (<span lang="en">ICRP</span>) để ước tính nguy cơ ngẫu nhiên dài hạn (chủ yếu là nguy cơ gây ung thư và di truyền) đối với sức khỏe con người từ việc phơi nhiễm bức xạ ion hóa. Nó tính đến:</p> <ul> <li>Lượng liều hấp thụ bởi các cơ quan và mô khác nhau.</li> <li>Loại bức xạ ion hóa (thông qua hệ số trọng số bức xạ, $W_R$, đối với tia X trong CT thì $W_R=1$).</li> <li>Độ nhạy cảm khác nhau của các cơ quan và mô đối với tác động có hại của bức xạ (thông qua hệ số trọng số mô, $W_T$).</li> </ul> <p>Đơn vị của Liều hiệu dụng là <span lang="en">Sievert</span> ($Sv$), nhưng trong chẩn đoán y tế thường dùng <span lang="en">miliSievert</span> ($mSv$), với $1 \, Sv = 1000 \, mSv$.</p> <h3>Công thức tổng quát (theo <span lang="en">ICRP</span>):</h3> <div class="formula-display">$$E = \sum_T W_T \times H_T = \sum_T W_T \times \sum_R (W_R \times D_{T,R})$$</div> <p>Trong đó:</p> <ul> <li>$H_T$: Liều tương đương ở mô hoặc cơ quan $T$.</li> <li>$W_T$: Hệ số trọng số mô cho mô $T$.</li> <li>$D_{T,R}$: Liều hấp thụ trung bình từ bức xạ $R$ trong mô $T$.</li> <li>$W_R$: Hệ số trọng số bức xạ cho loại bức xạ $R$.</li> </ul> <h3>Ước tính Liều hiệu dụng từ $DLP$ trong <span lang="en">CT</span>:</h3> <p>Trong thực hành lâm sàng, việc tính $E$ theo công thức đầy đủ là phức tạp. Do đó, người ta thường sử dụng phương pháp ước tính dựa trên $DLP$ và một hệ số chuyển đổi $k$ (<span lang="en">k-factor</span>) đặc trưng cho vùng cơ thể được quét. Hệ số $k$ này được tính toán dựa trên các mô hình <span lang="en">phantom</span> và phân bố liều điển hình.</p> <div class="formula-display">$$E \; (mSv) \approx DLP \; (mGy \cdot cm) \times k \; (mSv \cdot mGy^{-1} \cdot cm^{-1})$$</div> <p>Hệ số $k$ có giá trị khác nhau cho các vùng cơ thể (ví dụ: đầu, ngực, bụng, chậu) và có thể khác nhau một chút giữa các tài liệu tham khảo hoặc chuẩn quốc gia.</p> <h3>Ý nghĩa trong thực hành lâm sàng:</h3> <p>Liều hiệu dụng $E$ cho phép:</p> <ul> <li>Đánh giá và so sánh nguy cơ bức xạ tiềm ẩn từ các loại xét nghiệm hình ảnh khác nhau (ví dụ: so sánh <span lang="en">CT</span> ngực với X-quang ngực).</li> <li>Hỗ trợ việc cân bằng giữa lợi ích chẩn đoán và nguy cơ bức xạ khi lựa chọn hoặc tối ưu hóa quy trình chụp.</li> <li>Theo dõi liều tích lũy cho bệnh nhân, đặc biệt là những người cần chụp chiếu nhiều lần.</li> <li>Thiết lập và kiểm tra các mức tham chiếu chẩn đoán quốc gia hoặc địa phương (<span lang="en">Diagnostic Reference Levels - DRLs</span>).</li> </ul> <h4>Ví dụ tính $E$:</h4> <p>Sử dụng ví dụ $DLP = 350 \, mGy \cdot cm$ cho <span lang="en">CT</span> bụng. Giả sử hệ số $k$ cho vùng bụng là $0.015 \, mSv \cdot mGy^{-1} \cdot cm^{-1}$:</p> <div class="formula-display">$$E \approx 350 \, mGy \cdot cm \times 0.015 \, mSv \cdot mGy^{-1} \cdot cm^{-1} = 5.25 \, mSv$$</div>
            </article>

            <article id="cancer-risk-explanation" class="content-section explanation-section no-print">
                <h2>Ước tính Nguy cơ Ung thư từ Liều hiệu dụng</h2>
                <p>Liều hiệu dụng ($E$) cung cấp một phương tiện để ước tính nguy cơ ung thư gây ra bởi bức xạ (<span lang="en">Radiation-Induced Cancer Risk</span>) ở mức độ quần thể, dựa trên mô hình đáp ứng liều. Mô hình phổ biến nhất được chấp nhận cho mục đích bảo vệ bức xạ là mô hình Tuyến tính không ngưỡng (<span lang="en">Linear No-Threshold - LNT</span>). Mô hình này giả định rằng:</p> <ul> <li>Nguy cơ ung thư tăng tuyến tính với liều bức xạ.</li> <li>Không có ngưỡng liều nào được coi là hoàn toàn an toàn (bất kỳ liều nào, dù nhỏ, cũng có thể làm tăng nguy cơ).</li> </ul> <p>Dựa trên các báo cáo khoa học uy tín như BEIR VII (<span lang="en">Biological Effects of Ionizing Radiation VII</span>) và các ấn phẩm của <span lang="en">ICRP</span>, nguy cơ tử vong do ung thư trong suốt cuộc đời được ước tính tăng thêm khoảng <strong>5.5% cho mỗi <span lang="en">Sievert</span></strong> (tức là $0.0055$ cho mỗi $Sv$, hay <strong>$5.5 \times 10^{-5}$ cho mỗi $mSv$</strong>) đối với một quần thể hỗn hợp về độ tuổi và giới tính.</p> <p><strong>Những điểm cần lưu ý khi diễn giải nguy cơ này:</strong></p> <ul> <li><strong>Tính không chắc chắn:</strong> Các ước tính này có độ không chắc chắn đáng kể, đặc biệt là ở mức liều thấp thường gặp trong chẩn đoán y tế. Chúng được ngoại suy từ dữ liệu liều cao (như những người sống sót sau bom nguyên tử).</li> <li><strong>Nguy cơ cá nhân vs. Quần thể:</strong> Các hệ số nguy cơ này áp dụng tốt nhất cho đánh giá rủi ro ở cấp độ quần thể. Nguy cơ thực tế cho một cá nhân cụ thể bị ảnh hưởng bởi nhiều yếu tố như tuổi tại thời điểm phơi nhiễm (trẻ em và người trẻ nhạy cảm hơn), giới tính (phụ nữ thường có nguy cơ cao hơn một chút đối với một số loại ung thư), tiền sử gia đình, lối sống (hút thuốc), và cơ quan nào nhận liều cao nhất.</li> <li><strong>Mục đích chính:</strong> Việc ước tính nguy cơ này chủ yếu phục vụ cho việc thiết lập các tiêu chuẩn an toàn bức xạ, tối ưu hóa quy trình (nguyên tắc ALARA), và truyền thông nguy cơ một cách cân bằng, chứ không phải để dự đoán chính xác liệu một cá nhân có bị ung thư do một cuộc chụp <span lang="en">CT</span> hay không.</li> </ul> <h3>Ví dụ ước tính nguy cơ:</h3> <p>Sử dụng liều hiệu dụng từ ví dụ <span lang="en">CT</span> bụng $E = 5.25 \, mSv$:</p> <div class="formula-display">$$\text{Ước tính nguy cơ tử vong do ung thư tăng thêm} \approx 5.25 \, mSv \times (5.5 \times 10^{-5} / mSv) \approx 2.89 \times 10^{-4}$$</div> <p>Con số này tương đương với khoảng <strong>1 trường hợp tử vong do ung thư tăng thêm trên khoảng 3460 người</strong> nhận cùng mức liều này. Đây là một mức tăng nguy cơ rất nhỏ so với nguy cơ ung thư nền tự nhiên trong suốt cuộc đời (khoảng 20-25% dân số tử vong do ung thư từ mọi nguyên nhân cộng lại).</p> <p><strong>Kết luận:</strong> Mặc dù nguy cơ từ một lần chụp <span lang="en">CT</span> đơn lẻ là thấp, việc hiểu và định lượng nguy cơ này giúp nhấn mạnh tầm quan trọng của việc chỉ định hợp lý và tối ưu hóa liều trong thực hành lâm sàng hàng ngày để giảm thiểu phơi nhiễm bức xạ không cần thiết cho bệnh nhân.</p>
            </article>

            <section id="dose-comparison" class="content-section dose-comparison-section no-print">
              <h2>Liều hiệu dụng trung bình từ các kỹ thuật X-quang và <span lang="en">CT</span></h2>
              <p>Bảng dưới đây cung cấp các giá trị liều hiệu dụng ($E$) trung bình tham khảo cho một số kỹ thuật chẩn đoán hình ảnh sử dụng bức xạ ion hóa phổ biến. Nó cũng so sánh mức liều này với thời gian tương đương nhận liều từ bức xạ nền tự nhiên (giả định mức nền trung bình khoảng 3 mSv/năm).</p>
              <table class="dose-table"> <thead> <tr> <th>Kỹ thuật (<span lang="en">Technique</span>)</th> <th>Liều hiệu dụng ($E$) ($mSv$)</th> <th>Tương đương bức xạ nền</th> </tr> </thead> <tbody> <tr><td>X-quang Ngực (PA)</td><td>0.02 - 0.1</td><td>~ Vài ngày - 10 ngày</td></tr> <tr><td>X-quang Bụng (KUB)</td><td>0.7</td><td>~ 3 tháng</td></tr> <tr><td>X-quang Cột sống thắt lưng</td><td>1.4</td><td>~ 6 tháng</td></tr> <tr><td>X-quang Chi (tay, chân)</td><td>&lt; 0.01</td><td>&lt; 1 ngày</td></tr> <tr><td>X-quang Răng (Trong miệng)</td><td>0.005</td><td>~ 1 ngày</td></tr> <tr><td>X-quang Toàn cảnh Răng (Panoramic)</td><td>0.025</td><td>~ 3 ngày</td></tr> <tr><td>Chụp X-quang Vú KTS (Mammography)</td><td>0.21</td><td>~ 26 ngày</td></tr> <tr><td>Chụp X-quang Vú Tomosynthesis (3D)</td><td>0.27</td><td>~ 33 ngày</td></tr> <tr><td>Chụp <span lang="en">CT</span> Đầu (Không cản quang)</td><td>1.6 - 2.0</td><td>~ 7-8 tháng</td></tr> <tr><td>Chụp <span lang="en">CT</span> Đầu (Có và không cản quang)</td><td>3.2 - 4.0</td><td>~ 13-16 tháng</td></tr> <tr><td>Chụp <span lang="en">CT</span> Ngực (Liều chuẩn)</td><td>6.1 - 8.0</td><td>~ 2 - 2.7 năm</td></tr> <tr><td>Chụp <span lang="en">CT</span> Ngực (Tầm soát ung thư phổi liều thấp - LDCT)</td><td>1.0 - 1.5</td><td>~ 4-6 tháng</td></tr> <tr><td>Chụp <span lang="en">CT</span> Bụng</td><td>5.0 - 7.0</td><td>~ 1.7 - 2.3 năm</td></tr> <tr><td>Chụp <span lang="en">CT</span> Bụng và Chậu</td><td>7.7 - 10.0</td><td>~ 2.6 - 3.3 năm</td></tr> <tr><td>Chụp <span lang="en">CT</span> Bụng và Chậu (đa pha)</td><td>15 - 20+</td><td>~ 5 - 7+ năm</td></tr> <tr><td>Chụp <span lang="en">CT</span> Cột sống</td><td>8.0 - 10.0</td><td>~ 2.7 - 3.3 năm</td></tr> <tr><td>Chụp <span lang="en">CT</span> Mạch vành (<span lang="en">Coronary CTA</span>)</td><td>5.0 - 15.0 (thay đổi nhiều)</td><td>~ 1.7 - 5 năm</td></tr> <tr><td>Chụp <span lang="en">CT</span> Đánh giá vôi hóa mạch vành (<span lang="en">Calcium Scoring</span>)</td><td>1.0 - 3.0</td><td>~ 4 tháng - 1 năm</td></tr> <tr><td>Chụp <span lang="en">PET/CT</span> (Toàn thân, dùng $^{18}$F-FDG)</td><td>15.0 - 25.0</td><td>~ 5 - 8.3 năm</td></tr> <tr><td>Đo mật độ xương (<span lang="en">DEXA</span>)</td><td>~ 0.001</td><td>~ Vài giờ</td></tr> </tbody> </table> <div class="source"> <p><strong>Nguồn tham khảo:</strong> Dữ liệu tổng hợp từ <span lang="en">ACR</span>, <span lang="en">RadiologyInfo.org</span>, <span lang="en">ICRP</span>, và các nghiên cứu. <strong>Lưu ý:</strong> Các giá trị này là trung bình và liều thực tế cho mỗi bệnh nhân có thể thay đổi đáng kể tùy thuộc vào thiết bị, kỹ thuật chụp, kích thước bệnh nhân và cơ sở y tế.</p> </div>
            </section>

          </main>

          <footer class="main-footer no-print">
           <div>
             <p>© <span id="copyright-year">2025</span> <strong>Cộng đồng Kỹ thuật viên hình ảnh y học Việt Nam</strong> – Tầm soát Ung thư phổi bằng <span lang="en">CT</span> liều thấp</p>
             <p>Biên soạn bởi nhóm <strong>KTV 3 Miền</strong> | Mục đích: Đào tạo & Tham khảo y khoa</p>
             <p><em>Tuyên bố miễn trừ trách nhiệm: Thông tin trên trang web này chỉ mang tính tham khảo, không thay thế cho chẩn đoán, chỉ định hoặc tư vấn y tế chuyên nghiệp từ bác sĩ hoặc chuyên gia y tế có trình độ.</em></p>
           </div>
          </footer>

      </div> </div> <div id="print-output-container">
      <div id="print-title">BÁO CÁO LIỀU HIỆU DỤNG CT ƯỚC TÍNH</div>
      <div id="print-patient-info">
          <h4>Thông tin Bệnh nhân</h4>
          <div id="print-patient-name"><span>Tên:</span> ---</div>
          <div id="print-patient-age"><span>Tuổi:</span> ---</div>
          <div id="print-patient-id"><span>ID:</span> ---</div>
      </div>
      <div id="print-input-params">
          <h4>Thông số Quét</h4>
          <div id="print-body-region"><span>Vùng cơ thể:</span> ---</div>
          <div id="print-dlp-value"><span>Giá trị DLP:</span> --- mGy·cm</div>
      </div>
      <div id="print-formula">
          Công thức: E (mSv) = DLP (mGy·cm) × k (mSv·mGy⁻¹·cm⁻¹)
      </div>
      <div id="print-result-dose">
          Liều hiệu dụng ước tính (E): --- mSv
      </div>
      <div id="print-risk-warning">
          </div>
      <div id="print-date-footer">
          Ngày tạo báo cáo: <span id="print-date"></span>
      </div>
  </div>
  <script>
    // --- BEGIN: Smooth Scrolling Script ---
    document.querySelectorAll('.side-nav a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            try {
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    document.querySelectorAll('.side-nav a').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else { console.warn(`Smooth scroll target not found: ${targetId}`); }
            } catch (error) { console.error(`Error scrolling to target: ${targetId}`, error); }
        });
    });
    // --- END: Smooth Scrolling Script ---


    // --- BEGIN: Calculator Script ---
    // DOM References
    const bodyRegionSelect = document.getElementById("bodyRegion");
    const kValueInput = document.getElementById("kValue");
    const dlpInput = document.getElementById("dlp");
    const patientNameInput = document.getElementById("patientName");
    const patientAgeInput = document.getElementById("patientAge");
    const patientIdInput = document.getElementById("patientId");
    const resultDiv = document.getElementById("resultDose");
    const riskWarningDiv = document.getElementById("riskWarning");
    const calculateButton = document.getElementById("calculateButton");
    const printButton = document.getElementById("printButton");
    // Print Output References
    const printPatientName = document.getElementById("print-patient-name");
    const printPatientAge = document.getElementById("print-patient-age");
    const printPatientId = document.getElementById("print-patient-id");
    const printBodyRegion = document.getElementById("print-body-region");
    const printDlpValue = document.getElementById("print-dlp-value");
    const printFormula = document.getElementById("print-formula");
    const printResultDose = document.getElementById("print-result-dose");
    const printRiskWarning = document.getElementById("print-risk-warning");
    const printDate = document.getElementById("print-date");

    // Function to update K value based on selection
    function updateK() {
      kValueInput.value = bodyRegionSelect.value;
    }

    // Function to clear print output area
    function clearPrintOutput() {
        printPatientName.innerHTML = "<span>Tên:</span> ---";
        printPatientAge.innerHTML = "<span>Tuổi:</span> ---";
        printPatientId.innerHTML = "<span>ID:</span> ---";
        printBodyRegion.innerHTML = "<span>Vùng cơ thể:</span> ---";
        printDlpValue.innerHTML = `<span>Giá trị DLP:</span> --- mGy·cm`;
        printFormula.innerHTML = `Công thức: E (mSv) = DLP (mGy·cm) × k (mSv·mGy⁻¹·cm⁻¹)`;
        printResultDose.textContent = "Liều hiệu dụng ước tính (E): --- mSv";
        printRiskWarning.innerHTML = "";
        printDate.textContent = "";
    }


    // Main calculation function
    function calculateDose() {
      // 1. Reset displays
      resultDiv.textContent = "";
      resultDiv.className = "result-display";
      riskWarningDiv.innerHTML = "";
      riskWarningDiv.style.display = "none";
      printButton.style.display = "none";
      clearPrintOutput();

      // 2. Get input values
      const dlp = parseFloat(dlpInput.value);
      const k = parseFloat(kValueInput.value);
      const patientName = patientNameInput.value.trim();
      const patientAge = patientAgeInput.value.trim();
      const patientId = patientIdInput.value.trim();
      const selectedRegionOption = bodyRegionSelect.options[bodyRegionSelect.selectedIndex];
      const selectedRegionText = selectedRegionOption.value ? selectedRegionOption.text : "---";

      // 3. Validate inputs
      if (bodyRegionSelect.value === "") {
        resultDiv.textContent = "⚠️ Vui lòng chọn vùng cơ thể.";
        resultDiv.classList.add("error");
        return;
      }
      if (isNaN(dlp) || dlp <= 0) {
        resultDiv.textContent = `⚠️ Vui lòng nhập giá trị DLP hợp lệ (số dương). Giá trị nhập: "${dlpInput.value}"`;
        resultDiv.classList.add("error");
        return;
      }

      // 4. Perform calculation
      const dose = dlp * k;
      const roundedDose = Math.round(dose * 100) / 100;

      // 5. Display result on screen
      resultDiv.textContent = `Liều hiệu dụng ước tính (E): ${roundedDose} mSv`;
      resultDiv.classList.add("success");

      // 6. Calculate and prepare risk warning HTML
      const riskFactorPerMSv = 5.5e-5;
      const additionalRisk = roundedDose * riskFactorPerMSv;
      let warningMessageHTML = "";
      let printWarningMessageHTML = "";

      if (additionalRisk > 0) {
          const oneInY = Math.round(1 / additionalRisk);
          const formattedOneInY = oneInY.toLocaleString('vi-VN');
          const riskText = (oneInY > 0 && oneInY < 1000000)
                         ? `tương đương với rủi ro ước tính khoảng <strong>1</strong> trường hợp tử vong do ung thư phát sinh thêm trên <strong>${formattedOneInY}</strong> người nhận cùng mức liều này.`
                         : `là một mức tăng nguy cơ rất nhỏ về mặt thống kê.`;

          // Create HTML for the on-screen warning display
          warningMessageHTML = `
              <p><strong>Thông tin tham khảo về Nguy cơ Bức xạ:</strong></p>
              <p>Mức liều hiệu dụng <strong>${roundedDose} mSv</strong> ${riskText}</p>
              <p><em>Điều quan trọng cần lưu ý:</em></p>
              <ul>
                  <li>Đây là <strong>ước tính nguy cơ dựa trên thống kê</strong> cho cả cộng đồng, sử dụng mô hình Tuyến tính không ngưỡng (LNT). Mô hình này có những giới hạn và độ không chắc chắn, đặc biệt ở mức liều thấp.</li>
                  <li>Nguy cơ <strong>thực tế cho mỗi cá nhân</strong> có thể cao hơn hoặc thấp hơn đáng kể, phụ thuộc vào nhiều yếu tố như: tuổi tại thời điểm phơi nhiễm (trẻ em và người trẻ nhạy cảm hơn), giới tính, yếu tố di truyền, lối sống (ví dụ: hút thuốc), và cơ quan nào của cơ thể nhận liều bức xạ.</li>
                  <li>Mức tăng nguy cơ <strong>cộng thêm</strong> này cần được xem xét trong bối cảnh nguy cơ ung thư nền tự nhiên mà mọi người đều đối mặt (nguy cơ tử vong do ung thư từ mọi nguyên nhân trong suốt cuộc đời vào khoảng 20-25% ở nhiều quốc gia).</li>
                  <li>Thông tin này được cung cấp để nhấn mạnh tầm quan trọng của việc chỉ định chụp chiếu hợp lý và áp dụng các biện pháp tối ưu hóa liều (nguyên tắc ALARA), <strong>không</strong> nhằm mục đích dự đoán tình trạng sức khỏe cụ thể cho bất kỳ cá nhân nào.</li>
              </ul>
          `;
          // Create HTML for the print output
          printWarningMessageHTML = `
              <p><strong>Thông tin tham khảo về Nguy cơ Bức xạ:</strong></p>
              <p>Với mức liều hiệu dụng <strong>${roundedDose} mSv</strong>, ${riskText}</p>
              <p><strong>Lưu ý quan trọng:</strong></p>
              <ul>
                  <li>Đây là ước tính nguy cơ thống kê, không phải dự đoán cá nhân. Nguy cơ thực tế phụ thuộc vào tuổi, giới tính, di truyền, lối sống, v.v.</li>
                  <li>Mức tăng nguy cơ này rất nhỏ so với nguy cơ ung thư nền tự nhiên.</li>
                  <li>Luôn cần cân nhắc lợi ích chẩn đoán và áp dụng nguyên tắc ALARA.</li>
              </ul>
          `;

          // 7. Display warning on screen and show print button
          riskWarningDiv.innerHTML = warningMessageHTML;
          riskWarningDiv.style.display = "block";
          printButton.style.display = "inline-block";

          // 8. Populate the hidden print output container
          printPatientName.innerHTML = `<span>Tên:</span> ${patientName || '---'}`;
          printPatientAge.innerHTML = `<span>Tuổi:</span> ${patientAge || '---'}`;
          printPatientId.innerHTML = `<span>ID:</span> ${patientId || '---'}`;
          printBodyRegion.innerHTML = `<span>Vùng cơ thể:</span> ${selectedRegionText}`;
          printDlpValue.innerHTML = `<span>Giá trị DLP:</span> ${dlpInput.value} mGy·cm`;
          printFormula.innerHTML = `Công thức: E (${roundedDose} mSv) = DLP (${dlpInput.value} mGy·cm) × k (${k})`;
          printResultDose.textContent = `Liều hiệu dụng ước tính (E): ${roundedDose} mSv`;
          printRiskWarning.innerHTML = printWarningMessageHTML;
          const today = new Date();
          printDate.textContent = today.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });


      } else {
           printButton.style.display = "none";
           clearPrintOutput();
      }
    }

    // --- Event Listeners ---
    bodyRegionSelect.addEventListener("change", updateK);
    calculateButton.addEventListener("click", calculateDose);
    dlpInput.addEventListener("keypress", function(event) { if (event.key === "Enter") { event.preventDefault(); calculateDose(); } });
    patientNameInput.addEventListener("keypress", function(event) { if (event.key === "Enter") { event.preventDefault(); calculateDose(); }});
    patientAgeInput.addEventListener("keypress", function(event) { if (event.key === "Enter") { event.preventDefault(); calculateDose(); }});
    patientIdInput.addEventListener("keypress", function(event) { if (event.key === "Enter") { event.preventDefault(); calculateDose(); }});
    printButton.addEventListener("click", function() { window.print(); });
    // --- END: Calculator Script ---

    document.getElementById('copyright-year').textContent = new Date().getFullYear();
    updateK(); // Initial K value update

  </script>

</body>
</html>
